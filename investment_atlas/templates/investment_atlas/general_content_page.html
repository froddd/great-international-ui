{% extends 'investment_atlas/base_cms.html' %}

{% block content %}
    {% include 'investment_atlas/includes/hero_image.html' with image=page.hero_image %}

    {% include 'investment_atlas/includes/hero_heading.html' with title=page.title %}

    <div class="atlas-container">
        <div class="atlas-grid">
            <div class="atlas-grid__column atlas-grid__column--6-12-m">
                <p class="atlas-body--l atlas-m-t-0">{{ page.strapline }}</p>
                <div class="atlas-body--s">
                    {{ page.introduction|safe }}
                </div>
            </div>
            {% if page.intro_image %}
                <div class="atlas-grid__column atlas-grid__column--6-12-m">
                    <img src="{{ page.intro_image.url }}"
                         alt="{{ page.intro_image.alt }}"
                         class="atlas-image atlas-m-b-m">
                </div>
            {% endif %}
        </div>
    </div>

    <div class="atlas-alternate-bg--3-tone">
        {% for section in page.main_content %}
            <section>
                <div class="atlas-container atlas-p-t-l atlas-p-b-s">
                    {% for block in section.value.content %}

                        {% if block.type == 'header' %}
                            <h2 class="atlas-h--l atlas-m-b-m">{{ block.value }}</h2>
                        {% endif %}

                        {% if block.type == 'nested_content' %}
                            {% for sub_block in block.value %}

                                {% if sub_block.type == 'text' %}
                                    <div class="atlas-grid{% if sub_block.value.image.image %} atlas-grid--masonry{% endif %}">
                                        {% if sub_block.value.image.image %}
                                            <div class="atlas-grid__column atlas-grid__column--right atlas-grid__column--6-12-m">
                                                <div class="atlas-cms-text atlas-p-b-m">
                                                    <img class="atlas-image" src="{{ sub_block.value.image.image }}"
                                                         alt="{{ sub_block.value.image.image_alt }}">
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="atlas-grid__column{% if sub_block.value.image.image %} atlas-grid__column--left atlas-grid__column--6-12-m{% else %} atlas-grid__column--8-12-m{% endif %}">
                                            <div class="atlas-cms-text atlas-p-b-m">
                                                {{ sub_block.value.text|safe }}
                                            </div>

                                            {% if sub_block.value.cta_link %}
                                                <a href="{{ sub_block.value.cta_link }}" class="atlas-button">
                                                    {{ sub_block.value.cta_label|default:"Find out more" }}
                                                    <span class="atlas-button__icon">
                                                        {% include 'investment_atlas/includes/svg/icon-arrow.svg' %}
                                                    </span>
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}

                                {% if sub_block.type == 'columns' %}
                                    {% with sub_block.value|length as cols %}
                                        <div class="atlas-grid">
                                            {% for column in sub_block.value %}
                                                <div class="atlas-grid__column atlas-grid__column--{% if cols == 1 %}8{% elif cols|divisibleby:3 %}4{% elif cols|divisibleby:2 %}6{% else %}4{% endif %}-12-m">
                                                    <div class="atlas-cms-text atlas-p-b-m">
                                                        {{ column.value|safe }}
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endwith %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}

                    {% endfor %}
                </div>
            </section>
        {% endfor %}
    </div>

    {% include 'investment_atlas/includes/speak_to_us.html' %}

{% endblock content %}
